<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 760 740" fill="none">
  <style>
    text { font-family: system-ui, -apple-system, sans-serif; }
    .box { rx: 8; ry: 8; }
    .label { font-size: 14px; fill: #1a1a2e; font-weight: 600; }
    .sublabel { font-size: 11px; fill: #6b7280; }
    .arrow { stroke: #9ca3af; stroke-width: 1.5; marker-end: url(#ah); }
    .arrow-red { stroke: #e03131; stroke-width: 1.5; stroke-dasharray: 6 3; marker-end: url(#ah-red); }
    .note { font-size: 11px; fill: #6b7280; font-style: italic; }
    .heading { font-size: 20px; fill: #3b82f6; font-weight: 700; }
    .section { font-size: 11px; fill: #788591; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
  </style>
  <defs>
    <marker id="ah" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#9ca3af"/>
    </marker>
    <marker id="ah-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#e03131"/>
    </marker>
  </defs>

  <!-- Title -->
  <text class="heading" x="400" y="30" text-anchor="middle">wasmCloud v1 Architecture</text>

  <!-- Row 1: Developer → wash CLI → OAM Manifest -->
  <ellipse cx="120" cy="80" rx="60" ry="24" fill="#f3f4f6" stroke="#788591" stroke-width="1.5"/>
  <text class="label" x="120" y="84" text-anchor="middle">Developer</text>

  <text class="sublabel" x="215" y="66" text-anchor="middle">uses</text>
  <line class="arrow" x1="180" y1="80" x2="248" y2="80"/>

  <rect class="box" x="250" y="58" width="140" height="44" fill="#e6f0f7" stroke="#005799" stroke-width="1.5"/>
  <text class="label" x="320" y="84" text-anchor="middle">wash CLI</text>

  <text class="sublabel" x="435" y="66" text-anchor="middle">defines</text>
  <line class="arrow" x1="390" y1="80" x2="478" y2="80"/>

  <rect class="box" x="480" y="56" width="180" height="48" fill="#fff8e6" stroke="#d4a017" stroke-width="1.5"/>
  <text class="label" x="570" y="76" text-anchor="middle">OAM Manifest</text>
  <text class="sublabel" x="570" y="92" text-anchor="middle">wadm.yaml</text>

  <!-- Arrow down from OAM to wadm -->
  <line class="arrow" x1="570" y1="104" x2="570" y2="158"/>

  <!-- Row 2: wadm -->
  <text class="section" x="20" y="178">SCHEDULER</text>
  <rect class="box" x="290" y="160" width="310" height="48" fill="#f0ecff" stroke="#6741d9" stroke-width="1.5"/>
  <text class="label" x="445" y="180" text-anchor="middle">wadm</text>
  <text class="sublabel" x="445" y="196" text-anchor="middle">Application Deployment Manager</text>

  <!-- Arrow down from wadm to JetStream (straight down to box edge) -->
  <text class="sublabel" x="340" y="232" text-anchor="end">reads/writes state</text>
  <line class="arrow" x1="350" y1="208" x2="350" y2="258"/>

  <!-- Arrow down from wadm to NATS Core (straight down to box edge) -->
  <text class="sublabel" x="550" y="232">reconciles via</text>
  <line class="arrow" x1="540" y1="208" x2="540" y2="258"/>

  <!-- Row 3: NATS JetStream + NATS Core -->
  <text class="section" x="20" y="280">INFRASTRUCTURE</text>
  <rect class="box" x="180" y="260" width="210" height="48" fill="#e6f0f7" stroke="#005799" stroke-width="1.5"/>
  <text class="label" x="285" y="280" text-anchor="middle">NATS JetStream</text>
  <text class="sublabel" x="285" y="296" text-anchor="middle">State Store</text>

  <rect class="box" x="460" y="260" width="210" height="48" fill="#e6f0f7" stroke="#005799" stroke-width="1.5"/>
  <text class="label" x="565" y="280" text-anchor="middle">NATS Core</text>
  <text class="sublabel" x="565" y="296" text-anchor="middle">Lattice Transport</text>

  <!-- Arrows down from NATS Core to each Host (vertical drops, no crossing) -->
  <polyline class="arrow" points="500,308 500,332 190,332 190,368" fill="none"/>
  <polyline class="arrow" points="565,308 565,342 400,342 400,368" fill="none"/>
  <polyline class="arrow" points="630,308 630,348 610,348 610,368" fill="none"/>

  <!-- Row 4: Hosts -->
  <text class="section" x="20" y="390">HOSTS</text>
  <rect class="box" x="100" y="370" width="180" height="44" fill="#e6ecf3" stroke="#002e5d" stroke-width="1.5"/>
  <text class="label" x="190" y="396" text-anchor="middle">wasmCloud Host</text>

  <rect class="box" x="310" y="370" width="180" height="44" fill="#e6ecf3" stroke="#002e5d" stroke-width="1.5"/>
  <text class="label" x="400" y="396" text-anchor="middle">wasmCloud Host</text>

  <rect class="box" x="520" y="370" width="180" height="44" fill="#e6ecf3" stroke="#002e5d" stroke-width="1.5"/>
  <text class="label" x="610" y="396" text-anchor="middle">wasmCloud Host</text>

  <!-- Arrows down to Actors/Providers -->
  <line class="arrow" x1="190" y1="414" x2="190" y2="468"/>
  <line class="arrow" x1="400" y1="414" x2="400" y2="468"/>
  <line class="arrow" x1="610" y1="414" x2="610" y2="468"/>

  <!-- Row 5: Actors + Provider -->
  <text class="section" x="20" y="490">WORKLOADS</text>
  <rect class="box" x="110" y="470" width="160" height="48" fill="#e6f9f3" stroke="#00bc8e" stroke-width="1.5"/>
  <text class="label" x="190" y="490" text-anchor="middle">Actor</text>
  <text class="sublabel" x="190" y="506" text-anchor="middle">Component</text>

  <rect class="box" x="320" y="470" width="160" height="48" fill="#e6f9f3" stroke="#00bc8e" stroke-width="1.5"/>
  <text class="label" x="400" y="490" text-anchor="middle">Actor</text>
  <text class="sublabel" x="400" y="506" text-anchor="middle">Component</text>

  <rect class="box" x="530" y="470" width="160" height="48" fill="#ffe6e6" stroke="#e03131" stroke-width="1.5"/>
  <text class="label" x="610" y="490" text-anchor="middle">HTTP Server</text>
  <text class="sublabel" x="610" y="506" text-anchor="middle">Capability Provider</text>

  <!-- Red dashed arrow: Actor to HTTP Provider (routes over middle Actor box) -->
  <polyline class="arrow-red" points="270,494 290,494 290,442 500,442 500,494 528,494" fill="none"/>

  <!-- Row 6: More providers (below with clear spacing) -->
  <rect class="box" x="320" y="570" width="160" height="48" fill="#ffe6e6" stroke="#e03131" stroke-width="1.5"/>
  <text class="label" x="400" y="590" text-anchor="middle">Messaging</text>
  <text class="sublabel" x="400" y="606" text-anchor="middle">Capability Provider</text>

  <rect class="box" x="530" y="570" width="160" height="48" fill="#ffe6e6" stroke="#e03131" stroke-width="1.5"/>
  <text class="label" x="610" y="590" text-anchor="middle">Key-Value</text>
  <text class="sublabel" x="610" y="606" text-anchor="middle">Capability Provider</text>

  <!-- Red dashed arrows: Actor 2 to lower providers (route down, then across to avoid box overlap) -->
  <polyline class="arrow-red" points="400,518 400,538 400,568" fill="none"/>
  <polyline class="arrow-red" points="480,504 510,540 610,540 610,568" fill="none"/>

  <!-- Annotation -->
  <text class="note" x="400" y="648" text-anchor="middle">Dashed red arrows = distributed calls over NATS lattice (~5,000 RPS)</text>

  <!-- Legend -->
  <rect class="box" x="120" y="678" width="16" height="16" fill="#e6f9f3" stroke="#00bc8e" stroke-width="1.5"/>
  <text class="sublabel" x="142" y="691">Actor / Component</text>

  <rect class="box" x="280" y="678" width="16" height="16" fill="#ffe6e6" stroke="#e03131" stroke-width="1.5"/>
  <text class="sublabel" x="302" y="691">Capability Provider</text>

  <rect class="box" x="450" y="678" width="16" height="16" fill="#e6f0f7" stroke="#005799" stroke-width="1.5"/>
  <text class="sublabel" x="472" y="691">Infrastructure</text>

  <rect class="box" x="580" y="678" width="16" height="16" fill="#f0ecff" stroke="#6741d9" stroke-width="1.5"/>
  <text class="sublabel" x="602" y="691">Scheduler</text>
</svg>
