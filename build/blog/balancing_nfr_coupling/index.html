<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Using Capabilities to Decouple Non-Functional Requirements | wasmCloud</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://wasmcloud.com/blog/balancing_nfr_coupling"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Using Capabilities to Decouple Non-Functional Requirements | wasmCloud"><meta data-rh="true" name="description" content="A look at the motivation and design behind loosely coupling services for actors"><meta data-rh="true" property="og:description" content="A look at the motivation and design behind loosely coupling services for actors"><meta data-rh="true" property="og:image" content="https://wasmcloud.com/img/train_coupling.jpg"><meta data-rh="true" name="twitter:image" content="https://wasmcloud.com/img/train_coupling.jpg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-10-04T13:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://wasmcloud.com/blog/balancing_nfr_coupling"><link data-rh="true" rel="alternate" href="https://wasmcloud.com/blog/balancing_nfr_coupling" hreflang="en"><link data-rh="true" rel="alternate" href="https://wasmcloud.com/blog/balancing_nfr_coupling" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="wasmCloud RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="wasmCloud Atom Feed">




<link rel="alternate" type="application/rss+xml" href="/community/rss.xml" title="wasmCloud RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/community/atom.xml" title="wasmCloud Atom Feed"><link rel="stylesheet" href="/assets/css/styles.17e61a64.css">
<link rel="preload" href="/assets/js/runtime~main.5d88fd1e.js" as="script">
<link rel="preload" href="/assets/js/main.9fb51e84.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/wasmcloud_green.svg" alt="wasmCloud Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/wasmcloud_green.svg" alt="wasmCloud Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">wasmCloud</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community">Community</a><a class="navbar__item navbar__link" href="/docs/intro">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/wasmcloud" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/globally_distributed_webassembly_applications_with_wasmcloud_and_nats">Globally Distributed WebAssembly Applications with wasmCloud and NATS</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/balancing_nfr_coupling">Using Capabilities to Decouple Non-Functional Requirements</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/road_to_ubiquity">WebAssembly and the Road to Ubiquity</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/wasmcloud_third_anniversary">Reflections on Three Years of wasmCloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/webassembly_components_and_wasmcloud_actors_a_glimpse_of_the_future">WebAssembly Components and wasmCloud Actors: A Glimpse of the Future</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/example_creating_webassembly_actor_in_go_with_tinygo">Building Portable, Scalable Components with TinyGo and wasmCloud</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/caps_are_effects">wasmCloud Capabilities are Managed Algebraic Effects for WebAssembly Functions</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022-05-23_ghcr-actions">Deploying wasmCloud Actors from Github Packages</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://wasmcloud.com/img/train_coupling.jpg"><header><h1 class="title_f1Hy" itemprop="headline">Using Capabilities to Decouple Non-Functional Requirements</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-10-04T13:00:00.000Z" itemprop="datePublished">October 4, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Kevin Hoffman</span></div></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="train-coupling" src="/assets/images/train_coupling-f0d5f6fec53363b0f7bba4d819a7a1c1.jpg" width="1014" height="792" class="img_ev3q"></p><p>This post explores the motivation and design behind the loose coupling between our actors and capabilities.</p><p>Developers have a number of creeds to which we hold dear. Sometimes these show up as pattern and practice recommendations. Sometimes they appear in blog posts, conference talks, or streams. They can also appear indirectly via the code we write. One such creed is the tenet of <em>loose coupling</em>. Everything needs to be loosely coupled, because we all known and preach that tight coupling is objectively bad. Everyone seems to know this, but we rarely stop to think about <em>why</em>.</p><p>Before getting into the meat of this post, let&#x27;s take a second to define <strong>non-functional requirements</strong>, often abbreviated as <strong>NFR</strong>s. The core, so-called &quot;pure&quot; functional part of our business logic defines the <strong><em>what</em></strong> of the application, while the NFRs define the <strong><em>how</em></strong>.</p><p>By way of example, let&#x27;s examine the anatomy of a fairly commonplace microservice that you might see deployed in any enterprise in a cloud or on Kubernetes. This example service is a RESTful one that validates requests, reads and write bank account information from a data store, and responds accordingly with JSON payloads over HTTP. For this sample, we might have the following sets of functional and non-functional requirements.</p><p><strong>Functional Requirements</strong>:</p><ul><li>Allow for the creation, deletion, and update of a bank account</li><li>Allow for querying summaries of multiple accounts</li><li>Allow for querying details on a single account</li><li>Validate all requests according to business rules</li><li>Accept requests via HTTP</li></ul><p><strong>Non-Functional Requirements</strong>:</p><ul><li>Store account details information in Postgres</li><li>Store account summaries in an in-memory Redis cache</li><li>Emit logs to stdout</li><li>Run 2 instances of the service per availability zone</li><li>Secure access to the HTTP endpoint via reverse proxy</li><li>Emit open telemetry spans and traces</li><li>Support and expose a prometheus metrics endpoint</li><li>Use <em>(your favorite)</em> HTTP server library</li><li>Use <em>(your favorite)</em> SSL tools</li><li>Secure access to the service via bearer token</li></ul><p>The amount of work required is definitely skewed toward the NFR end of the scale. With most of today&#x27;s traditional development tools and ecosystems, every deployment artifact bundles the solution to functional requirements with <em>just one</em> of the many solutions to the non-functional requirements <em>at build time</em>.</p><p>It&#x27;s pretty routine for developers to build a service that only works with Redis, only works with Postgres, only supports one way of emitting traces and spans, only manages logs one way, only handles prometheus metrics one way, only secures things one way, ... <em>you get the idea</em>. We might have some clever abstractions in our library code, we might even deftly employ <a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/anti-corruption-layer" target="_blank" rel="noopener noreferrer">anti-corruption layers</a>, but in the end, <em>we own our dependencies</em>, and despite calling it a microservice, we&#x27;re shipping a brittle monolith that only works against one rigid target environment.</p><p>Like everything in our line of work, there are <em>tradeoffs</em>. There are some advantages to making fixed architecture decisions once and codifying those decisions into the deployment artifact. This can often buy you rapid time to market and simplicity in some areas, while dramatically increasing complexity in others. The reverse is true as well, if everything is too flexible, too loosely coupled, then this mess may be too difficult to manage.</p><p><img loading="lazy" alt="Coupling Spectrum" src="/assets/images/coupling_spectrum-600af8d23b6af892e09e126dfaf14629.png" width="1085" height="292" class="img_ev3q"></p><p>As illustrated, there is a spectrum of coupling from utter and total tight coupling to free and unfettered, uncoupled design. On the far right, all of our components are stuck together, then crammed into a box and sealed. On the far left, we can end up with thousands of little tiny pieces that are so flexible that maintenance and discovery is a nightmare. Without me saying it, I bet you can imagine examples of current technologies that sit on either end of this spectrum.</p><p>What we want, rather than extremes, is the <em>right</em> balance. I want to write <em>just</em> the code that satisfies my functional requirements, and then let other aspects of my system take care of satisfying the NFRs. To satisfy the above example, I want to write code that utilizes <em>some</em> key-value store, <em>some</em> SQL database, <em>some</em> web server. I can then run that component against a test environment on my laptop, a medium-sized environment in the CI tests, and then massive scale when in production. More importantly, <em>while in production</em>, I can even change the deployment shape to suit changes in my user base, demand, load, etc.</p><p>When we separate the functional and non-functional requirements across specific <a href="https://en.wikipedia.org/wiki/Design_by_contract" target="_blank" rel="noopener noreferrer">contracts</a>, then we can hopefully achieve the right balance between coupling. You might look at the word <em>contract</em> here and think we&#x27;re just going back to anti-corruption layers or abstraction libraries inside our code. The difference is subtle but vital: requiring that the thing that satisfies the contract <em>not be a part of your code</em> is the magic sauce that balances the coupling scales.</p><p>If we own our dependencies, and the implementation of a contract is <em>not</em> a tightly coupled dependency, then we can finally say that, as developers, we don&#x27;t own the non-functional requirements. NFRs are still mandatory, still important, and still have to be dealt with. However, if our <em>unit of deployment</em> doesn&#x27;t own them, then they are free to change, update, and move on their own cadence, <em>for their own reasons</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="wasmcloud-nfrs-and-capabilities">wasmCloud, NFRs, and Capabilities<a class="hash-link" href="#wasmcloud-nfrs-and-capabilities" title="Direct link to heading">​</a></h2><p>All of this lead-up and background hopefully explains why wasmCloud has chosen the abstractions we&#x27;ve chosen. We know that if we write a microservice that requires access to an <strong>S3</strong> bucket, it&#x27;s going to be a huge pain to work with locally (even with tools like <em>minio</em>). The functional requirements of my code are &quot;store this data in a blob store&quot;. Why should we be forced to decide on S3 and then live with that decision for the lifetime of the component?</p><p>By implementing a contract like the one we have for <code>wasmcloud:blobstore</code>, and writing code against that contract, wasmCloud actors can interact with files on disk during the local developer iteration cycle, some other abstraction during automated tests, and then real S3 buckets in production. The important thing is that the code no longer owns the choice of S3, or the configuration thereof.</p><p>WebAssembly&#x27;s enforced hard boundary between the guest and the host mandates that developers choose where their code ends and the host-provided functionality begins. By forcing us to draw this line for real rather than have this line be something that is either implicitly or accidentally drawn (and subsequently violated), we can actually turn this so-called limitation into an advantage and build highly composable, distributed components that have <em>just the right</em> amount of coupling with the components that satisfy their non-functional requirements.</p><p>To see how wasmCloud has leveraged this kind of NFR decoupling, check out our documentation on <a href="https://wasmcloud.dev/app-dev/std-caps/" target="_blank" rel="noopener noreferrer">capability providers</a>. For an example of us demonstrating hot-swapping between a file system and S3 live, at runtime, without a recompile or redeploy, check out this <a href="https://youtu.be/s_Y-ISP58qk?t=522" target="_blank" rel="noopener noreferrer">wasmCloud community meeting</a>.</p><p>Today wasmCloud uses the Smithy DSL to define and describe these contracts. When we started, we had to fend for ourselves when it came to contracts and code generation. Hopefully soon, when the <a href="/blog/webassembly_components_and_wasmcloud_actors_a_glimpse_of_the_future">component model</a> becomes more of a real thing, we&#x27;ll be able to take our contracts and turn them into component specifications that will work in wasmCloud <em>or anywhere else</em> that supports components.</p><p><strong><em>That</em></strong> is the real pot of gold at the end of the rainbow, and the ultimate payoff for maintaining the right coupling balance.</p><hr><p><em>Cover Photo by Daniel Schwen - Own work, CC BY-SA 4.0, <a href="https://commons.wikimedia.org/w/index.php?curid=4784168" target="_blank" rel="noopener noreferrer">https://commons.wikimedia.org/w/index.php?curid=4784168</a></em></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/globally_distributed_webassembly_applications_with_wasmcloud_and_nats"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Globally Distributed WebAssembly Applications with wasmCloud and NATS</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/road_to_ubiquity"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">WebAssembly and the Road to Ubiquity</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#wasmcloud-nfrs-and-capabilities" class="table-of-contents__link toc-highlight">wasmCloud, NFRs, and Capabilities</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/wasmcloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://slack.wasmcloud.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://calendar.google.com/calendar/u/0/embed?src=c_6cm5hud8evuns4pe5ggu3h9qrs@group.calendar.google.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Calendar &amp; wasmCloud Wednesdays<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/community">Community Meeting Notes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social &amp; More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/wasmcloud" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/company/wasmCloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy">Privacy Policy</a></li><li class="footer__item"><a class="footer__link-item" href="/terms-conditions">Terms and Conditions</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 wasmCloud LLC. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: https://www.linuxfoundation.org/trademark-usage. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5d88fd1e.js"></script>
<script src="/assets/js/main.9fb51e84.js"></script>
</body>
</html>